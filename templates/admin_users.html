{% extends "base.html" %}
{% block title %}Users â€“ VIP Clinic Launch Tracker{% endblock %}
{% block content %}
<div class="container">
  <div class="page-header">
    <div class="page-title">ðŸ‘¥ User Management</div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 360px;gap:20px">
    <!-- User list -->
    <div class="card">
      <div class="card-header"><span class="card-title">All Users ({{ users|length }})</span></div>
      <table class="task-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Username</th>
            <th>Role</th>
            <th>Department</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td><strong>{{ u.full_name }}</strong></td>
            <td><code>{{ u.username }}</code></td>
            <td>
              {% if u.role == 'admin' %}<span class="badge badge-gold">Admin</span>
              {% elif u.role == 'dept_head' %}<span class="badge badge-in-progress">Dept Head</span>
              {% else %}<span class="badge badge-not-started">Team Member</span>{% endif %}
            </td>
            <td>{{ u.department or 'â€“' }}</td>
            <td>
              {% if u.id != session.user_id %}
              <form method="POST" action="{{ url_for('admin_delete_user', user_id=u.id) }}" class="confirm-delete" style="display:inline">
                <button class="btn btn-danger btn-xs">Delete</button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Add user form -->
    <div class="card">
      <div class="card-header"><span class="card-title">âž• New User</span></div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('admin_new_user') }}">
          <div class="form-group">
            <label class="form-label">Full Name *</label>
            <input type="text" name="full_name" class="form-control" required>
          </div>
          <div class="form-group">
            <label class="form-label">Username *</label>
            <input type="text" name="username" class="form-control" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password *</label>
            <input type="password" name="password" class="form-control" required>
          </div>
          <div class="form-group">
            <label class="form-label">Role</label>
            <select name="role" class="form-control">
              <option value="team_member">Team Member</option>
              <option value="dept_head">Department Head</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Department</label>
            <select name="department" class="form-control">
              <option value="">â€“ None â€“</option>
              {% for d in departments %}
              <option value="{{ d }}">{{ d }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-gold w-100" style="justify-content:center">Create User</button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
@media (max-width: 768px) {
  div[style*="grid-template-columns:1fr 360px"] { grid-template-columns: 1fr !important; }
}
</style>
{% endblock %}
